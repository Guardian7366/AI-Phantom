# configs/maze_train.yaml
seed: 42
device: "auto"          # "auto" | "cuda" | "cpu"

env:
  size: 8
  wall_prob: 0.24
  max_gen_tries: 200
  max_steps: 128

  # Rewards (más señal para lvl2)
  step_penalty: -0.01
  invalid_move_penalty: -0.02
  goal_reward: 1.0
  progress_reward: 0.02   # ✅ subir señal (0.01 suele ser lento en lvl2)

  # Distancia mínima start-goal
  min_bfs_start_goal_lvl1: 2
  min_bfs_start_goal_lvl2: 4

  # Pool lvl2 (más estable para consolidar)
  lvl2_grid_pool_size: 64
  lvl2_pool_refresh_prob: 0.05  # ✅ menos ruido que 0.10

agent:
  seed: 42
  num_actions: 4

  gamma: 0.99
  lr: 0.0002              # ✅ ligeramente más estable que 2.5e-4
  batch_size: 64
  replay_size: 60000

  # Double DQN + target
  tau: 0.005

  # PER + n-step
  per_alpha: 0.6
  per_beta_start: 0.4
  per_beta_frames: 400000  # ✅ anneal más largo -> menos sacudidas
  n_step: 5

  # Epsilon schedule (steps)
  epsilon_start: 1.0
  epsilon_end: 0.05
  epsilon_decay_steps: 500000  # ✅ más exploración para lvl2

  # Training
  warmup_steps: 2000
  update_every: 1
  grad_clip_norm: 10.0
  use_amp: true

train:
  run_name: "maze_dqn_rainbowlite_lvl2_lock"
  num_episodes: 6000           # ✅ un poco más para consolidar lvl2
  max_steps_per_episode: 128

  results_dir: "results/runs"
  checkpoint_dir: "results/checkpoints"

  # Eval (señal limpia para best_lvl2)
  eval_every_episodes: 100
  eval_episodes: 600            # ✅ menos varianza que 400

  # Curriculum
  success_window: 200
  advance_threshold: 0.98
  curriculum_max_level: 2

  # Anti “pozo” al avanzar
  epsilon_reset_on_advance: true
  epsilon_reset_value: 0.35
  epsilon_reset_steps: 35000     # ✅ un poco más largo
  reset_replay_on_advance: false

  # Rescate lvl2 (más estable / menos spam)
  rescue_on_stuck: true
  rescue_level: 2
  rescue_sr_threshold: 0.65      # ✅ si cae por debajo de esto sostenido -> rescate
  rescue_patience_episodes: 300
  rescue_epsilon_value: 0.30
  rescue_epsilon_steps: 35000
  rescue_cooldown_episodes: 400